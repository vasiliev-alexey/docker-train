##            Основы Docker


#### Компоненты Docker
1. Daemon - процесс в операционной системе котрый используя библиотеку libcontainer   и функции ядра Linux cgroups и namespaces заставляет работать.
2. Client - клиентская часть, которая взаимодействует с Daemon по протоколу  https, может быть написана на любом языке используя интерфейсы (коннекторы)
3. Registry - реестр образов для Docker

#### Технологиии поддержки предоставляемые Docker
1. Swarm - решение для кластеризации
2. Docker Compose - решение для объединения узлов для одного приложения
3. Docker Machine - решение для создания узлов на локальных и удаленных ресурсках
4. Kitematic - GUI Для Windows и Mac
5. Docker Trusted Registry = локальный  реестр


#### Как создаются образы
Для создания образа используется команда build
> docker build <Dockerfile> <Контекст>

<Dockerfile> - указывается имя файла, или путь к нему или STDIN
<Контекст> - может быть пустым,
  * . - текущая диретория
  * абсольтгый или относительный пусть к диретории
  * URL
  * git репозитрии

Образ строится на "луковой архитектуре"
Для получения списка слоев используется опция history

#### Инструкции в Dockerfile
* ADD - добавляет файлы из контекста, может добавлять из архива (файлы будут автоматически распакованы) или по URL. Множественное присутсвие
* CMD - выполняет заданную инструкцию во время инициализации контейнера, может быть указан несколько раз, но будет выполнена тоьлко последняя.
* COPY - копирует файлы из исходной среды в создавемый контейнер. имеет 2 формата source target и ["source", "target"]
* ENTRYPOINT - определяет выполнемый файл и параметры , выполнемую при инициализации контейнера. Обычно скрипт, выставлющий окружение и запускающий основную програму.
* ENV- определет переменный среды внутри создавемого контейнера.
* EXPOSE  - сообщает среде докер, что контейнер будет прослушивать или использовать определенные порты в сетевой инфраструктуре. Используется для установления сетевой инфраструктуры между контйнерами
* FROM - задает базовый образ для создавемого контейнера в формате IMAGE:TAG
* MAINTAINER -  автор создавемого контейнера
* ONBUILD - задавет инструкцию, которая будет выполнена, если данный образ станет базовым, и будет выполнен в момент создания  дочернего образа
* RUN  - запусакет данную инструкцию внутри контйнера и сохранет результат
* USER - задает UID пользователя, с правами которого будут выполнятя комманды RUN CMD  ADD. UID един для хоста и контенйнера, имена могут отличатся.
* VOLUME - объявляет заданый каталог или файл хоста как том.
* WORKDIR - объявляет рабочий каталог для последующих инструкций.

#### Установление свзи с внешним миром
Для установления сетвого взаимодействия необходимо открыть порты с помощью параметров -p  или -P
  -p  принмает доп аргументом мапинг порта хоста и контенера - например 8000:80
  -P  хост выдает контейнеру, первый свободный порт
Для установления какие порты открыты для контейнера используется комманда port
docker port

#### Соединения между контейнерами
Для установления связи между контенерами используется механизм icc . Он активируется с помошью опции --link CONTAINER:ALIAS
Внутри связаного контейнера создается ряд перемеменных сетевой инфрастуктуры + унаследованных от связаного контенера. Адрес связаного контейнера добавляется в iptables. В будущеем данный механизм может быть задеприкейчен, и  лучше пользоваться методами обнаружения сервисов.
Если нужно отключит связь контейнеров требуется указать  --icc-false --iptables при запуске демона.

#### Управление данных  с помощью томов и контейнеров данных
Существыет 3 способа монитирования  томов в контейнер
1. Указание опции -v /xxx -создает том в контейнере, имеет отображение на хостовую систему в диреткорию управляемую демоном docker
> docker run -v /data  debian ls /data

2. Указание в Dockerfile инструкции VOLUME
> FROM debian:lastest   
> VOLUME /data

3. Указание в опции -v отображения томов в хсостовой системе на контейнерну.
> docker run -v /home/alex/data_to_container:/data_in_container debian ls /data

#### Совместное использование данных
Для совместного использования томов в нескольких контейнерах используется опция --volumes-from CONTAINER
> docker run -it -h NEWCONTAINER  --volumes-from container-test debian /bin/bash  h
